{% extends 'base.html' %}
{% load static %}
{% block title %}User Dashboard - Mess Management{% endblock %}
{% block content %}
<div class="dashboard-header">
    <h1>My Dashboard</h1>
    <p class="subtitle">{{ current_month }}</p>
</div>

<div class="stats-grid">
    <div
        class="stat-card {% if payment.status == 'paid' %}stat-success{% elif payment.status == 'pending' %}stat-warning{% else %}stat-danger{% endif %}">
        <div class="stat-icon">ğŸ’³</div>
        <div class="stat-content">
            <h3>{% if payment %}{{ payment.get_status_display }}{% else %}Not Set{% endif %}</h3>
            <p>Payment Status</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">â‚¹</div>
        <div class="stat-content">
            <h3>{% if payment %}â‚¹{{ payment.amount|floatformat:2 }}{% else %}â‚¹0.00{% endif %}</h3>
            <p>My Payment</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
            <h3>â‚¹{{ total_expenses|floatformat:2 }}</h3>
            <p>Total Expenses</p>
        </div>
    </div>
</div>

<div class="dashboard-content dashboard-grid">
    <div class="card">
        <div class="card-header">
            <h2>Quick Actions</h2>
        </div>
        <div class="card-body">
            <div class="quick-actions">
                <a href="{% url 'user_payment' %}" class="action-btn">
                    <span class="action-icon">ğŸ’°</span>
                    <span>Make Payment</span>
                </a>
                <a href="{% url 'transparent_data' %}" class="action-btn">
                    <span class="action-icon">ğŸ“ˆ</span>
                    <span>View Mess Data</span>
                </a>
                <a href="{% url 'user_send_message' %}" class="action-btn">
                    <span class="action-icon">âœ‰ï¸</span>
                    <span>Contact Admin</span>
                </a>
                <a href="{% url 'user_meal_calendar' %}" class="action-btn">
                    <span class="action-icon">ğŸ½ï¸</span>
                    <span>Meal Calendar</span>
                </a>
                <a href="{% url 'user_receipt' %}?month={{ current_month }}" class="action-btn">
                    <span class="action-icon">ğŸ“„</span>
                    <span>Download Receipt</span>
                </a>
            </div>
        </div>
    </div>

    {% if payment %}
    <div class="card">
        <div class="card-header">
            <h2>Payment Details</h2>
        </div>
        <div class="card-body">
            <div class="payment-details">
                <div class="detail-row">
                    <span>Amount:</span>
                    <strong>â‚¹{{ payment.amount|floatformat:2 }}</strong>
                </div>
                <div class="detail-row">
                    <span>Status:</span>
                    <span class="badge badge-{{ payment.status }}">{{ payment.get_status_display }}</span>
                </div>
                {% if payment.transaction_id %}
                <div class="detail-row">
                    <span>Transaction ID:</span>
                    <strong>{{ payment.transaction_id }}</strong>
                </div>
                {% endif %}
                {% if payment.paid_date %}
                <div class="detail-row">
                    <span>Paid On:</span>
                    <strong>{{ payment.paid_date|date:"d M Y H:i" }}</strong>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if recent_messages %}
    <div class="card card-full-width">
        <div class="card-header">
            <h2>Recent Messages & Notifications</h2>
        </div>
        <div class="card-body">
            {% for msg in recent_messages %}
            <div class="message-item message-{{ msg.status }}">
                <div class="message-header">
                    <strong>{{ msg.subject }}</strong>
                    <span class="message-date">{{ msg.created_at|date:"d M Y, h:i A" }}</span>
                </div>
                <div class="message-body">{{ msg.message }}</div>
                {% if msg.admin_reply %}
                <div class="admin-reply">
                    <strong>Admin Reply:</strong>
                    <p>{{ msg.admin_reply }}</p>
                    <small class="text-muted">{{ msg.replied_at|date:"d M Y, h:i A" }}</small>
                </div>
                {% endif %}
                <span class="badge badge-{{ msg.status }}">{{ msg.get_status_display }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<style>
    /* Dashboard specific responsive styles */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    @media (min-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .dashboard-grid .card-full-width {
            grid-column: 1 / -1;
        }
    }

    .admin-reply {
        margin-top: 1rem;
        padding: 1rem;
        background: rgba(102, 126, 234, 0.1);
        border-left: 3px solid var(--primary);
        border-radius: 4px;
    }

    .admin-reply strong {
        color: var(--primary);
    }

    .admin-reply p {
        margin: 0.5rem 0;
    }
</style>
{% endblock %}